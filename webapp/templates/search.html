{% extends "layout.html" %}
{%- import "components/search.html" as search -%}
{%- import "components/bookmark.html" as bookmark -%}
{%- import "components/event.html" as event -%}
{%- import "components/external.html" as external -%}
{%- import "components/video_player.html" as video_player -%}

{% block content %}
<section class="section" data-has-videos="{{ has_videos }}">
    <div class="columns">
        <div class="column">
            {% call search::form(query, year, current_fosdem.selectable_years) %}
        </div>
    </div>

    {% if has_videos %}
    <div class="tabs is-boxed" id="search-tabs">
        <ul>
            <li class="is-active" data-tab="events-tab">
                <a href="#events">
                    <span class="icon is-small"><i class="fa-solid fa-calendar-days"></i></span>
                    <span>Events</span>
                </a>
            </li>
            <li data-tab="videos-tab">
                <a href="#videos">
                    <span class="icon is-small"><i class="fa-solid fa-video"></i></span>
                    <span>Videos</span>
                </a>
            </li>
        </ul>
    </div>
    {% endif %}

    <div id="events-tab" class="tab-content">
        {% for item in items %}
        <a name="{{item.event.id}}"></a>
        {% call event::card(item.event, item.related) %}
        {% endfor %}
    </div>

    {% if has_videos %}
    <div id="videos-tab" class="tab-content" style="display: none;">
        {% call video_player::player("search-video") %}
    </div>
    {% endif %}
</section>
{% endblock %}

{% block bookmarks_callbacks %}
{% if has_videos %}
<script type="module">
    import { createVideoPlayer } from '/assets/video_player.js';

    function bindSearchVideoPlayer(model) {
        createVideoPlayer('search-video', '[data-has-video="true"]');

        const eventsTabContent = document.getElementById('events-tab');
        const videosTabContent = document.getElementById('videos-tab');
        const tabItems = document.querySelectorAll('#search-tabs li');

        function selectTab(tabId) {
            tabItems.forEach(t => {
                const isActive = t.dataset.tab === tabId;
                t.classList.toggle('is-active', isActive);
            });
            eventsTabContent.style.display = tabId === 'events-tab' ? '' : 'none';
            videosTabContent.style.display = tabId === 'videos-tab' ? '' : 'none';
        }

        // Select tab based on URL hash
        const hash = window.location.hash;
        if (hash === '#videos') {
            selectTab('videos-tab');
        }

        // Handle tab clicks
        tabItems.forEach(tab => {
            tab.addEventListener('click', () => selectTab(tab.dataset.tab));
        });
    }

    document.bookmarksCallbacks = [ bindSearchVideoPlayer ];
</script>
{% endif %}
{% endblock %}
